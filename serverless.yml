service: adamrms
useDotenv: true
provider:
  name: aws
  region: eu-west-1
  stage: prod
  runtime: provided.al2
  apiGateway:
    binaryMediaTypes:
      - '*/*'
    environment:
      BREF_BINARY_RESPONSES: '1'
plugins:
  - ./vendor/bref/bref
  - serverless-python-requirements
custom:
  pythonRequirements:
    dockerizePip: non-linux
package:
  exclude:
    - node_modules/**
    - .jekyll-cache/**
    - cdnAssets/
    - AWSLambda/**
    - docker/**
    - docs/**
    - tests/**
    - .env
    - Dockerfile
    - docker-compose-yml
    - Readme.md
    - updater.sh
    - Procfile
    - html/admin/**
functions:
  app:
    name: ${opt:stage, self:provider.stage, 'dev'}-AdamRMS # optional, Deployed Lambda name
    description: AdamRMS Main Lambda
    memorySize: 1024 # memorySize for this specific function.
    reservedConcurrency: 5
    tags:
      project: adam-rms
    handler: html/AWSLambdaAPI/index.php
    timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds)
    layers:
      - ${bref:layer.php-74-fpm}
    events:
      #- httpApi: '*'
      - http: 'ANY /'
      - http: 'ANY /{proxy+}'
  s3deletor:
    name: ${opt:stage, self:provider.stage, 'dev'}-AdamRMS-S3Deletor # optional, Deployed Lambda name
    runtime: python3.8
    description: AdamRMS S3 Deletor
    memorySize: 128
    reservedConcurrency: 1
    tags:
      project: adam-rms
    handler: functions/s3deletor/lambda_function.py
    timeout: 900
    events:
      - schedule:
         name: 6am-daily
         description: 'Run the Deletor at 6am Daily'
         rate: cron(00 6 * * ? *)
         enabled: true