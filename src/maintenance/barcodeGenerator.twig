{% extends "assets/template.twig" %}
{% block content %}
    <div class="row">
        <div class="col-12 col-md-12 col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Assets</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <select class="form-control" multiple="multiple" placeholder="Select assets to print barcodes for" id="assetSearch" lines>
                            {% for asset in preFetch %}
                                <option value="{{asset.assets_id}}" selected="selected">{{ asset.assets_tag|aTag }} | {{ asset.assetTypes_name}} ({{ asset.manufacturers_name }})</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Groups</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <select class="form-control" multiple="multiple" placeholder="Select groups of assets to print barcodes for" id="assetGroups" lines>
                        </select>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Blanks</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="callout callout-default">
                            Use blank barcodes to label new assets, then associate them with {{ CONFIG.PROJECT_NAME }} assets later.
                        </div>
                        <input type="number" class="form-control" name="numStickers" id="blanksInput" min="0" value="0" max="500" />
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-12 col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Settings</h3>
                    <div class="card-tools pull-right">
<a href="{{ CONFIG.LINKS_USERGUIDEURL }}assets/asset-barcodes" target="_blank" type="button" class="btn btn-info btn-sm">Help</a>

                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                        <div class="text-muted">
                            <form id="settings">
                                <p class="text-sm">Barcode Type
                                    <b class="d-block">
                                        <select class="form-control select2-barcode-generator" id="barcodeTypeGenerator" name="barcodeType" style="width: 100%;">
                                            <option value="EAN_8" data-desc="8-digit linear barcode (numeric only)">EAN-8</option>
                                            <option value="EAN_13" data-desc="13-digit linear barcode (numeric only)">EAN-13</option>
                                            <option value="CODE_39" data-desc="Alphanumeric linear barcode">CODE-39</option>
                                            <option value="CODE_93" data-desc="Compact linear barcode">CODE-93</option>
                                            <option value="CODE_128" data-desc="High-density linear barcode">CODE-128</option>
                                            <option value="UPC_E" data-desc="Compact UPC barcode (numeric only)">UPC-E</option>
                                            <option value="UPC_A" data-desc="12-digit product barcode (numeric only)">UPC-A</option>
                                            <option value="QR_CODE" data-desc="2D matrix barcode" selected>QR Code</option>
                                        </select>
                                    </b>
                                </p>
                                <button type="button" class="btn btn-default generateButton" data-type="table">Generate Table of Barcodes</button>
                                <button type="button" class="btn btn-default generateButton" data-type="printout">Generate Sticker Printout</button>
                                <hr/>
                                <p>Sticker Printout Settings</p>
                                <p class="text-sm">Tag
                                    <b class="d-block">
                                        <select class="form-control" name="tags">
                                            <option value="0">Hide</option>
                                            <option value="1" selected>Show</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">Type
                                    <b class="d-block">
                                        <select class="form-control" name="typename">
                                            <option value="0" selected>Hide</option>
                                            <option value="1">Show</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">Mass
                                    <b class="d-block">
                                        <select class="form-control" name="mass">
                                            <option value="0">Hide</option>
                                            <option value="1" selected>Show</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">1<sup>st</sup> Definable Field
                                    <b class="d-block">
                                        <select class="form-control" name="definableField1">
                                            <option value="0" selected>Hide</option>
                                            <option value="1">Show</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">Length Colours<sup>1st Definable Field must be length</sup>
                                    <b class="d-block">
                                        <select class="form-control" name="lengthMode">
                                            <option value="0" selected>Disabled</option>
                                            <option value="1">Enabled</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">Show Business Name
                                    <b class="d-block">
                                        <input type="text" list="instanceNameOptionList" class="form-control" name="instanceName" />
                                        <datalist id="instanceNameOptionList">
                                            <option value="Hide">Hide</option>
                                            <option selected>{{ USERDATA.instance.instances_name }}</option>
                                        </datalist>
                                    </b>
                                </p>
                                <hr/>
                                <p class="text-sm">{{ USERDATA.instance.instances_name }} Logo
                                    <b class="d-block">
                                        <select class="form-control" name="instancelogo">
                                            <option value="0">Hide</option>
                                            <option value="1" selected>Show</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">{{ CONFIG.PROJECT_NAME }} Logo
                                    <b class="d-block">
                                        <select class="form-control" name="adamrmslogo">
                                            <option value="0" selected>Hide</option>
                                            <option value="1">Show</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">Paper Size
                                    <b class="d-block">
                                        <select class="form-control" name="pagesize">
                                            <option value="A4" selected>A4</option>
                                        </select>
                                    </b>
                                </p>
                                <p class="text-sm">Stickers Per Sheet
                                    <b class="d-block">
                                        <select class="form-control" name="numStickers">
                                            <option value="8" selected>8 - Standard</option>
                                            <option value="8cable">8 - Cable Style</option>
                                        </select>
                                    </b>
                                </p>
                            </form>
                        </div></div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="btn-group float-right">
                        <button type="button" class="btn btn-default generateButton" data-type="printout">Generate Sticker Printout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            $(".generateButton").click(function () {
                var assets = $("#assetSearch").val();
                var groups = $("#assetGroups").val();
                window.location="{{ CONFIG.ROOTURL }}/maintenance/barcodePrint.php?" + $('#settings').serialize() + "&ids=" + assets.join() + "&blanks=" + $("#blanksInput").val() + "&groups=" + groups.join() + "&type=" + $(this).data("type");
            });

            $("#assetSearch").select2({
                tags: false,
                multiple: true,
                theme: "bootstrap4",
                minimumInputLength: 1,
                width: '100%',

                minimumResultsForSearch: 1,
                placeholder: "Enter asset numbers to search for assets",
                ajax: {
                    url: "{{ CONFIG.ROOTURL }}/api/barcodes/searchAsset.php",
                    dataType: "json",
                    type: "POST",
                    data: function (params) {
                        var queryParameters = {
                            term: params.term
                        }
                        return queryParameters;
                    },
                    processResults: function (data) {
                        if (data && data.result && data.response) {
                            return {
                                results: $.map(data.response, function (item) {
                                    return {
                                        text: aTag(item.assets_tag) + " | " + item.assetTypes_name + " (" + item.manufacturers_name + ")",
                                        id: item.assets_id
                                    }
                                })
                            };
                        } else return {
                            results: []
                        };
                    }
                }
            });
            $("#assetGroups").select2({
                tags: false,
                multiple: true,
                theme: "bootstrap4",
                minimumInputLength: 1,
                width: '100%',
                minimumResultsForSearch: 1,
                placeholder: "Enter group name to search",
                ajax: {
                    url: "{{ CONFIG.ROOTURL }}/api/groups/search.php",
                    dataType: "json",
                    type: "POST",
                    data: function (params) {
                        var queryParameters = {
                            term: params.term
                        }
                        return queryParameters;
                    },
                    processResults: function (data) {
                        if (data && data.result && data.response) {
                            return {
                                results: $.map(data.response, function (item) {
                                    return {
                                        text: item.assetGroups_name,
                                        id: item.assetGroups_id
                                    }
                                })
                            };
                        } else return {
                            results: []
                        };
                    }
                }
            });

            // Initialize Select2 for barcode type with images
            function formatBarcodeTypeGenerator(option) {
                if (!option.id) {
                    return option.text;
                }

                // Define sample barcode images for different types
                var barcodeImages = {
                    'EAN_8': 'https://barcode.tec-it.com/barcode.ashx?data=1234567&code=EAN8&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0',
                    'EAN_13': 'https://barcode.tec-it.com/barcode.ashx?data=123456789012&code=EAN13&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0',
                    'CODE_39': 'https://barcode.tec-it.com/barcode.ashx?data=CODE39&code=Code39&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0',
                    'CODE_93': 'https://barcode.tec-it.com/barcode.ashx?data=CODE93&code=Code93&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0',
                    'CODE_128': 'https://barcode.tec-it.com/barcode.ashx?data=CODE128&code=Code128&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0',
                    'UPC_A': 'https://barcode.tec-it.com/barcode.ashx?data=01234567890&code=UPCA&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0',
                    'UPC_E': 'https://barcode.tec-it.com/barcode.ashx?data=0123456&code=UPCE&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0',
                    'QR_CODE': 'https://barcode.tec-it.com/barcode.ashx?data=QR&code=QRCode&translate-esc=on&dpi=96&imagetype=Gif&rotation=0&color=%23000000&bgcolor=%23ffffff&qunit=Mm&quiet=0'
                };

                var imageUrl = barcodeImages[option.id];
                var description = $(option.element).data('desc') || '';

                var $option = $(
                    '<div style="display: flex; align-items: center; padding: 8px 0;">' +
                        '<img src="' + imageUrl + '" style="height: 35px; width: auto; margin-right: 12px; border: 1px solid #dee2e6; border-radius: 3px; padding: 4px; background: white;" />' +
                        '<div style="flex: 1;">' +
                            '<div style="font-weight: 500; color: #212529;">' + option.text + '</div>' +
                            (description ? '<div style="font-size: 0.875rem; color: #6c757d;">' + description + '</div>' : '') +
                        '</div>' +
                    '</div>'
                );
                return $option;
            }

            $("#barcodeTypeGenerator").select2({
                theme: 'bootstrap4',
                placeholder: 'Select barcode type...',
                allowClear: false,
                templateResult: formatBarcodeTypeGenerator,
                templateSelection: function(option) {
                    if (!option.id) {
                        return option.text;
                    }
                    return option.text;
                },
                escapeMarkup: function(markup) {
                    return markup;
                }
            });
        });
    </script>
{% endblock %}