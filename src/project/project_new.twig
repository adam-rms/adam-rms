{% extends "assets/template.twig" %}
{% block content %}
{% if NOCAPACITY %}
<div class="row">
    <div class="col-md-12 col-lg-6 offset-lg-3">
        <div class="card box-solid">
            <div class="card-header">
                <h3 class="card-title">Cannot create projects</h3>
            </div>
            <div class="card-body">
                <p>Your current plan does not enable you to create any more projects as you have used your capacity.</p>
                <a href="{{ CONFIG.ROOTURL }}/instances/billing.php" class="btn btn-default">Billing Settings</a>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-md-12 col-lg-6 offset-lg-3"> 
        <div class="card box-solid">
            <div class="card-header">
                <h3 class="card-title">Add new Project</h3>
                <div class="card-tools pull-right">
                    <a href="{{ CONFIG.LINKS_USERGUIDEURL }}projects/" target="_blank" type="button" class="btn btn-info btn-sm">Help</a>
                </div>
            </div>
            <div class="card-body">
                <form id="addNewForm">
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend"><span class="input-group-text">Name</span></div>
                            <input type="text" class="form-control" id="projects_name" required minLength="1" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Project Manager</label>
                        <select class="form-control  select2bs4" id="manager" required>
                            {% for user in potentialProjectManagers %}
                                <option {{ user.users_userid == USERDATA.users_userid ? "selected" : "" }} value="{{ user.users_userid }}">{{ (user.users_name1 ~ " " ~ user.users_name2) }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Project Type</label>
                        <select class="form-control  select2bs4" id="type" required>
                            {% for type in potentialProjectTypes %}
                                <option value="{{ type.projectsTypes_id }}">{{ type.projectsTypes_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
            <div class="card-footer">
                <button class="btn btn-default float-right" id="saveButton">Save</button>
            </div>
            <div class="overlay">
                <i class="fas fa-2x fa-sync-alt"></i>
            </div>
        </div>
    </div>
</div>
    <style>
        .input-group {
            margin-bottom: 5px;
        }
    </style>
    <script>
        $(document).ready(function () {
            $(".overlay").hide();
            $("#manager").select2({
                theme: "bootstrap4",
                width: '100%'
            });
            $("#type").select2({
                theme: "bootstrap4",
                width: '100%'
            });
            $('#saveButton').on('click', function() {
                ajaxcall("projects/new.php", {
                    "projects_name": $('#projects_name').val(),
                    "projectsType_id": $('#type').val(),
                    "projects_manager": $('#manager').val()
                }, function (data) {
                    window.location.href = "{{ CONFIG.ROOTURL }}/project/?id=" + data.response['projects_id'];
                });
            });
        });
    </script>
    {% endif %}
{% endblock %}
